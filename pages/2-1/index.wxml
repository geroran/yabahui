<view class="container">
  <!-- 背景装饰 -->
  <view class="stars">
    <view class="star star-1"></view>
    <view class="star star-2"></view>
    <view class="star star-3"></view>
    <view class="star star-4"></view>
    <view class="star star-5"></view>
    <view class="star star-6"></view>
    <view class="star star-7"></view>
    <view class="star star-8"></view>
  </view>
  <view class="fog"></view>

  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-arrow">❮</text> 返回
    </view>
    <view class="title-box">
      <text class="title">祭拜神树</text>
      <text class="subtitle">Sacrifice to the God Tree</text>
    </view>
    <view class="timer-container {{timeLeft <= 10 ? 'urgent' : ''}}">
      <view class="timer-circle">
        <text class="timer-num">{{timeLeft}}</text>
      </view>
    </view>
  </view>

  <view class="scene-area">
    <view class="god-tree-container">
      <view class="god-tree">
        <view class="tree-aura"></view>
        <view class="tree-crown">
          <view class="leaf-cluster"></view>
          <view class="leaf-cluster right"></view>
        </view>
        <view class="tree-trunk"></view>
      </view>
      <view class="altar-stone"></view>
    </view>
    
    <view class="instruction-box">
      <text class="instruction-text">{{instructionText}}</text>
    </view>
  </view>

  <view class="action-panel">
    <view class="panel-bg"></view>
    <view 
      wx:for="{{steps}}" 
      wx:key="id" 
      class="action-item {{currentHighlightId === item.id ? 'highlight' : ''}} {{item.status}}"
      bindtap="onActionClick" 
      data-id="{{item.id}}"
    >
      <view class="talisman-paper">
        <view class="icon">{{item.icon}}</view>
        <view class="name">{{item.name}}</view>
      </view>
    </view>
  </view>

  <view class="overlay" wx:if="{{gameState === 'idle' || gameState === 'success' || gameState === 'fail'}}">
    <view class="modal {{gameState}}">
      <view class="modal-decoration top"></view>
      <view class="modal-title" wx:if="{{gameState === 'idle'}}">祭祀仪式</view>
      <view class="modal-title" wx:elif="{{gameState === 'success'}}">祭拜成功</view>
      <view class="modal-title" wx:else>仪式未成</view>

      <view class="modal-content">
        <text wx:if="{{gameState === 'idle'}}">请仔细观察神树指引的顺序，\n按顺序点击完成祭祀，祈求平安。</text>
        <view wx:elif="{{gameState === 'success'}}">
          <text class="culture-text">神树见证了你的虔诚。\n\n【文化小贴士】\n彝族人民视树为神灵的居所，祭祀神树不仅是祈福，更是表达对大自然养育之恩的敬畏与感谢。</text>
        </view>
        <text wx:else>顺序有误或时间已到，\n请平复心境，重新来过。</text>
      </view>

      <button class="start-btn" bindtap="startGame">
        {{gameState === 'idle' ? '开始祭拜' : '再试一次'}}
      </button>
      <view class="modal-decoration bottom"></view>
    </view>
  </view>
</view>
